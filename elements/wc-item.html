<dom-module id="wc-item">
    <template>
        <style>
        .marco {
            /* width: 25%;
            margin: 50px; */
            padding: 50px;
            text-align: center;
            border-style: solid;
            border-radius: 3px;
            background-color: red;
            display: inline-block;
        }
        </style>
        <!--         <template is="dom-repeat" items="{{items}}" as="item">
         -->
        <iron-ajax id="ajax" auto url="../data/users.json" handle-as="json" on-response="load" debounce-duration="300">
        </iron-ajax>
        <paper-dialog id="dialog">
            <h2>Welcome to myBrotein</h2>
            <p>Please Log In or Sign Up if you haven´t got an account</p>
            <div>
                <button type="button" class="btn btn-success" on-click="log">Log In</button>
                <button type="button" class="btn btn-success" on-click="sign">Sign Up</button>
            </div>
        </paper-dialog>
        <paper-dialog id="log">
            <p>Please enter your credentials</p>
            <div>
                <paper-input id="username" label="Username" type="text"></paper-input>
                <paper-input id="password" label="Password" type="password"></paper-input>
                <button class="btn btn-secondary" dialog-confirm on-tap="submit">Submit</button>
            </div>
        </paper-dialog>
        <paper-dialog id="sign">
            <p>Register</p>
        </paper-dialog>
        <paper-dialog id="cart">
            <div>
                <wc-cart item="{{item}}"></wc-cart>
                <div>
                    <button type="button" class="btn btn-success" on-click="back">Continue Shopping</button>
                    <button type="button" class="btn btn-success" on-click="dialog">Finish</button>
                </div>
            </div>
        </paper-dialog>
        <div class="marco">
            <h1>Items:</h1>
            <template is="dom-repeat" items="{{items}}" as="item">
                <div id="title">{{item.title}}</div>
                <div id="image"><img src="{{item.image}}" height="20%" width="20%"></img>
                </div>
                <div id="description">{{item.description}}</div>
                <div id="price">Price:{{item.price}}</div>
                <div id="amount">Amount:{{item.amount}}</div>
                <button type="button" value="{{item.price}}" class="btn btn-success" on-click="dialog">Buy</button>
                <hr>
            </template>
        </div>
        <!--       </template>
     -->
    </template>
    <script>
    (function() {
         Ticket = Polymer({
            is: "wc-item",
            properties: {
                items: {
                    type: Array
                },
                item: {
                    type: Number,
                    value: 0
                }
            },
            ready: function() {
                console.log("Estoy en WC-ITEM");
            },
            back: function() {
                this.$.cart.close();

            },
            dialog: function(e) {
                if (localStorage.getItem("username") !== null) {
                    this.$.cart.open();
                    this.$.cart.modal = true;
                    console.log("VOY A COMPROBAR LA VARIABLE ITEM");
                    this.item = this.item + parseInt(Polymer.dom(e).localTarget.value);
                    console.log("EL ITEM QUE TENGO ES", this.item);
                    this.notifyPath("item", this.item);

                } else {
                    this.$.dialog.open();
                    this.$.dialog.modal = true;
                }
            },
            log: function() {
                this.$.log.open();
                this.$.log.modal = true;
            },
            sign: function() {
                this.$.sign.open();
                this.$.sign.modal = true;
            },
            load: function(data) {
                console.log("Estoy en el load");
                this.users = data.detail.response;
                console.log("La lista de users completa es ", this.users);
                this.notifyPath("users", this.users);
            },
            submit: function() {
                var nombre = document.querySelector("#username").value;
                var clave = document.querySelector("#password").value;
                for (var i = 0; i < this.users.length; i++) {
                    if (this.users[i].username === nombre) {
                        console.log("El nombre de usuario es correcto");
                        if (this.users[i].password === clave) {
                            console.log("La contraseña es correcta");
                            localStorage.setItem("username", nombre);
                            alert("Usuario y contraseña correctos");
                        } else {
                            alert("Contraseña incorrecta");
                        }
                    } else {
                        alert("Usuario incorrecto");
                    }
                }
                this.$.log.close();
                this.$.dialog.close();
            }
        });
    })();
    </script>
</dom-module>
